<!DOCTYPE html>
<html>
<style>
#container {
  width: 500px;
  height: 300px;
  position: relative;
  background: lightBlue;
  overflow: hidden;   /* clip anything outside the container */
}

#animate {
  width: 30px;
  height: 30px;
  position: absolute;
  bottom: 30px;
  left: 5px;
}
#floor1 {
    width: 45px;
    height: 30px;
    position: absolute;
    background: green;
    bottom: 0px;
    left: 0px;
}
#water1 {
    width: 110px;
    height: 10px;
    position: absolute;
    background: blue;
    bottom: 0px;
    left: 45px;
}
#floor2 {
    width: 40px;
    height: 30px;
    position: absolute;
    background: green;
    bottom: 0px;
    left: 155px;
}
#water2 {
    width: 110px;
    height: 10px;
    position: absolute;
    background: blue;
    bottom: 0px;
    left: 195px; 
}
#floor3 {
    width: 40px;
    height: 30px;
    position: absolute;
    background: green;
    bottom: 0px;
    left: 305px;
}
#water3 {
    width: 110px;
    height: 10px;
    position: absolute;
    background: blue;
    bottom: 0px;
    left: 345px; 
}
#floor4 {
    width: 45px;
    height: 30px;
    position: absolute;
    background: green;
    bottom: 0px;
    left: 455px; 
}
#statsDiv {
    position: absolute;
    top: 0px;
    right: 0px;
}
#floor1, #floor2, #floor3, #floor4 {
    z-index: 2;   /* floors are above water but below wolf normally */
}

#water1, #water2, #water3 {
    z-index: 3;   /* water is above floors */
}

#animate {
    z-index: 4;   /* wolf normally above everything */
}

</style>

<!-- external javascript -->
<script src='../externalJS/gcf.js'>
  // greatest common factor for reducing fractions
  // function getGCF(a, b);
  // returns the greatest common factor of a and b
</script>

<script>
  
// global variables
var firstAttempt; // so that the user cannot jump more than once per question
var reset = false; // tells whether or not to reset the position
var numCorrect = 0; // after 3 consecutive correct answers, reset position, maybe increase the level
var level = 1;
var numberAttempted = 0; 
var numberCorrect = 0; 
var percentCorrect;

// constants for a clean, repeatable start
var START_LEFT = 3;      // starting left (px)
var START_BOTTOM = 30;    // starting bottom (px)  change if you prefer a different start

// reset the position of the animate object
function resetPosition() {
  var animate = document.getElementById("animate");
  animate.style.left = START_LEFT + "px";
  animate.style.bottom = START_BOTTOM + "px";
  animate.style.zIndex = 4;   // restore wolf above floors
} // end of resetPosition()


// load the page
function loadPage() {
    document.getElementById('newButton').focus();
    document.getElementById('answerInput1').style.display = 'none';
    document.getElementById('answerInput2').style.display = 'none';
    document.getElementById('orSpan').style.display = 'none';
    document.getElementById('checkButton').style.display = 'none';
    getStats();

    // ensure the wolf starts in the exact starting place
    resetPosition();
} // end of loadPage()

// smooth quadratic-bezier style vertical arc between start and end
function getArcY(progress, startY, endY, peak) {
  // quadratic Bezier: B(t) = (1-t)^2 * P0 + 2(1-t)t * P1 + t^2 * P2
  var t = progress;
  var oneMinusT = 1 - t;
  return (oneMinusT * oneMinusT * startY) + (2 * oneMinusT * t * peak) + (t * t * endY);
} // end of getArcY()

// correct answer → 150px right, land smoothly at 30px
function jumpSafe() {
  var animate = document.getElementById("animate");
  var startLeft = parseFloat(animate.style.left) || START_LEFT;
  var startBottom = parseFloat(animate.style.bottom) || START_BOTTOM;

  var totalSteps = 150;      // number of frames
  var distance = 150;        // pixels to travel right
  var stepX = distance / totalSteps;
  var targetBottom = 30;     // land at 30px for correct
  var jumpHeight = 40;       // how much above the higher of start/target the peak is
  var peak = Math.max(startBottom, targetBottom) + jumpHeight;

  var counter = 0;
  var id = setInterval(frame, 5);
  function frame() {
    counter++;
    var progress = counter / totalSteps;

    var posLeft = startLeft + stepX * counter;
    var posBottom = getArcY(progress, startBottom, targetBottom, peak);

    animate.style.left = posLeft + "px";
    animate.style.bottom = posBottom + "px";

    if (counter >= totalSteps) {
      clearInterval(id);
      // ensure exact final values (avoid tiny float residue)
      animate.style.left = (startLeft + distance) + "px";
      animate.style.bottom = targetBottom + "px";
      giveFeedback();
    }
  }
  // correct answer → wolf lands above everything
  animate.style.zIndex = 4;
  animate.style.bottom = targetBottom + "px";
} // end of jumpSafe()

// incorrect answer → 110px right, land smoothly at 5px, behind water
function jumpFail() {
  var animate = document.getElementById("animate");
  var startLeft = parseFloat(animate.style.left) || START_LEFT;
  var startBottom = parseFloat(animate.style.bottom) || START_BOTTOM;

  var totalSteps = 110;
  var distance = 110;
  var stepX = distance / totalSteps;
  var targetBottom = 5;
  var jumpHeight = 30;
  var peak = Math.max(startBottom, targetBottom) + jumpHeight;

  var counter = 0;

  // put wolf behind water during the jump
  animate.style.zIndex = 1;

  var id = setInterval(frame, 5);
  function frame() {
    counter++;
    var progress = counter / totalSteps;

    var posLeft = startLeft + stepX * counter;
    var posBottom = getArcY(progress, startBottom, targetBottom, peak);

    animate.style.left = posLeft + "px";
    animate.style.bottom = posBottom + "px";

    if (counter >= totalSteps) {
      clearInterval(id);
      animate.style.left = (startLeft + distance) + "px";
      animate.style.bottom = targetBottom + "px";
      // leave wolf behind water only for fail; will reset next problem
      giveFeedback();
    }
  }
} // end of jumpFail()


// get a whole number fact problem
function newProblem() {
    getDisplayForNewProblem();
    
    firstAttempt = true;
    if (reset) {resetPosition();}
    if (numCorrect > 2) {
        resetPosition(); 
        numCorrect = 0;
        level++;
    }

    // display the level;
    document.getElementById('statsDiv').innerHTML = 'Level: ' + level;

    // numbers to operate with
    var a, b, c, m, n;
    a = getRandom(-5, 4); if (a===0) {a=5;}
    m= getRandom(-20, 20);
    n = getRandom(-20, 20);
    b = a*m + a*n;
    c = a*m*n;
    
    problem = 'Solve for all possible values of the variable.<br /><br />';
    problem += a + 'x<sup>2</sup> + ' + b + 'x + ' + c + ' = 0';
    problem += '&nbsp;&nbsp;&nbsp&nbsp;&nbsp;(Hint: b<sup>2</sup> &ndash; 4ac = ';
    problem += b*b-4*a*c + ')';
    correctAnswer1 = -1*m;
    correctAnswer2 = -1*n;

    // display the problem
    document.getElementById('problemDiv').innerHTML = problem;

    // set focus on the textbox
    document.getElementById('answerInput1').focus();
} // end of newProblem()

function getDisplayForNewProblem() {
        // hide the get new problem button
    document.getElementById('newButton').style.visibility = 'hidden';
    // reset
    document.getElementById('answerInput1').value = '';
    document.getElementById('answerInput2').value = '';
    document.getElementById('feedbackDiv').innerHTML = '&nbsp;';
    document.getElementById('checkButton').style.display = 'inline';
    document.getElementById('answerInput1').style.display = 'inline';
    document.getElementById('answerInput2').style.display = 'inline';
    document.getElementById('orSpan').style.display = 'inline';
    document.getElementById('errorDiv').style.visibility = 'hidden';
} // end of getDisplayForNewProblem()

// NORMALLY EXTERNAL JS
// generate a random number
function getRandom(min, max) {

    var x = Math.floor(Math.random()*(max - min + 1)) + min;
    // NOTE: using 0.1 and 0.9 as min and max return values of 0.1 or 1.1 every time
    // This code probably only works for whole numbers
    
    return x; 

} // end of getRandom(min, max)

// check the user's answer
function checkAnswer() {
    // make sure an answer has been entered
    if (document.getElementById('answerInput1').value!=='' &&
        document.getElementById('answerInput2').value!=='') {
      document.getElementById('errorDiv').style.visibility = 'hidden';
      document.getElementById('checkButton').style.display = 'none';
      
      if (firstAttempt) {
          userAnswer1 = document.getElementById('answerInput1').value;
          userAnswer2 = document.getElementById('answerInput2').value;
          
          if (correctAnswer1==userAnswer2 && correctAnswer2==userAnswer1) { // 
            temp1 = userAnswer2;
            userAnswer2 = userAnswer1;
            userAnswer1 = temp1;
          }
          
          if (userAnswer1==correctAnswer1 && userAnswer2==correctAnswer2 && firstAttempt) {
              result = 'correct';        
              document.getElementById('newButton').focus();
              jumpSafe();
              reset = false;
              numCorrect++;
          }
          else {
              result = 'incorrect';        
              jumpFail();
              reset = true;
              numCorrect = 0;
          }       
      }
      
      firstAttempt = false;   
    // show the get new problem button
    document.getElementById('newButton').style.visibility = 'visible';    
    }
    else {
      document.getElementById('errorDiv').style.visibility = 'visible';
      // set focus on the textbox
      document.getElementById('answerInput1').focus();
    }
    
} // end of checkAnswer()

// give feedback ... set this in the animation function to run after clear(id)
function giveFeedback() {
    if (result === 'correct') {
        document.getElementById('feedbackDiv').innerHTML = '<br />Correct!';
    }
    else if (result === 'incorrect') {
        document.getElementById('feedbackDiv').innerHTML = '<br />Correct answer: ';
        document.getElementById('feedbackDiv').innerHTML += correctAnswer1 + ' or ' + correctAnswer2 + '<br />Try again!';
    }
    else {alert('error - giveFeedback()');}
    document.getElementById('newButton').focus();
} // end of giveFeedback()

// get the stats 
function getStats() {
    if (numberAttempted === 0) {percentCorrect = '';}
    else {
        percentCorrect = 100 * numberCorrect / numberAttempted;
        percentCorrect = roundDecimalNumber(percentCorrect, 1);        
    }

    temp1 = 'Level: ' + level;

    document.getElementById('statsDiv').innerHTML = temp1;
} // end of getStats()

// NORMALLY EXTERNAL JS
// round numbers
function roundDecimalNumber(number, places) {

    number = number * Math.pow(10, places);

    number = number.toFixed(0);

    number = number / Math.pow(10, places);

    return number;

} // end of roundDecimalNumber(number, places)

</script>

<body onload='loadPage()'>

<h3>Quadratic Formula ("Beginner" difficulty)</h3>

  <div id ="container">
  
  <button id='newButton' onclick='newProblem()'>New problem</button>
  
  <br /><br />
  <span id='problemDiv'>Click the button above to get a new problem</span>
  
  <br /><br />
  
  <input type='text' id='answerInput1' style='width: 50px;' />
   <span id='orSpan'> or </span> 
  <input type='text' id='answerInput2' style='width: 50px;' />
  <button id='checkButton' onclick='checkAnswer()'>Check answer</button>
  <div id='errorDiv' style='color:red; visibility:hidden;'>Type or click an answer in the box</div>
  <span id='statsDiv'>Stats</span>
  <span id='feedbackDiv'>&nbsp;</span>
  <span id='floor1'></span>
  <span id='water1'></span>
  <span id='floor2'></span>
  <span id='water2'></span>
  <span id='floor3'></span>
  <span id='water3'></span>
  <span id='floor4'></span>
  <span id ="animate"><img src='../images/wolf transparent.png' style='width:150%; height:150%'></span>
</div>






</body>
</html>
