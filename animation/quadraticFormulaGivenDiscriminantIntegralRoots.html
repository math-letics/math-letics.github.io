<!DOCTYPE html>
<html>
<style>
#container {
  width: 500px;
  height: 300px;
  position: relative;
  background: lightBlue;
  overflow: hidden;
}

#animate {
  width: 30px;
  height: 30px;
  position: absolute;
  bottom: 30px;
  left: 5px;
}
#floor1 {
    width: 45px;
    height: 30px;
    position: absolute;
    background: green;
    bottom: 0px;
    left: 0px;
}
#water1 {
    width: 110px;
    height: 10px;
    position: absolute;
    background: blue;
    bottom: 0px;
    left: 45px;
}
#floor2 {
    width: 40px;
    height: 30px;
    position: absolute;
    background: green;
    bottom: 0px;
    left: 155px;
}
#water2 {
    width: 110px;
    height: 10px;
    position: absolute;
    background: blue;
    bottom: 0px;
    left: 195px; 
}
#floor3 {
    width: 40px;
    height: 30px;
    position: absolute;
    background: green;
    bottom: 0px;
    left: 305px;
}
#water3 {
    width: 110px;
    height: 10px;
    position: absolute;
    background: blue;
    bottom: 0px;
    left: 345px; 
}
#floor4 {
    width: 45px;
    height: 30px;
    position: absolute;
    background: green;
    bottom: 0px;
    left: 455px; 
}
#statsDiv {
    position: absolute;
    top: 0px;
    right: 0px;
    text-align: right;
    line-height: 1.4;
    font-family: Arial, sans-serif;
    font-size: 14px;
    background: rgba(255,255,255,0.6);
    padding: 5px 8px;
    border-radius: 8px;
}
#floor1, #floor2, #floor3, #floor4 {
    z-index: 2;
}
#water1, #water2, #water3 {
    z-index: 3;
}
#animate {
    z-index: 4;
}
</style>

<script src='../externalJS/gcf.js'></script>

<script>
  
// global variables
var firstAttempt;
var reset = false;
var numCorrect = 0;
var level = 1;
var numberAttempted = 0; 
var numberCorrect = 0; 
var percentCorrect;
var problem;
var a, b, c, m, n;
var jumpInProgress = false;
var celebrateID = null;
var jumpID = null;

// constants
var START_LEFT = 3;
var START_BOTTOM = 30;

function resetPosition() {
    if (jumpID !== null) {
        clearInterval(jumpID);
        jumpID = null;
        jumpInProgress = false;
    }

    stopCelebrationBounce();

    var animate = document.getElementById("animate");
    animate.style.left = START_LEFT + "px";
    animate.style.bottom = START_BOTTOM + "px";
    animate.style.zIndex = 4;
} // end of resetPosition()

function loadPage() {
    document.getElementById('newButton').focus();
    document.getElementById('answerInput1').style.display = 'none';
    document.getElementById('answerInput2').style.display = 'none';
    document.getElementById('orSpan').style.display = 'none';
    document.getElementById('checkButton').style.display = 'none';
    getStats();
    resetPosition();
} // end of loadPage()

function getArcY(progress, startY, endY, peak) {
  var t = progress;
  var oneMinusT = 1 - t;
  return (oneMinusT * oneMinusT * startY) + (2 * oneMinusT * t * peak) + (t * t * endY);
} // end of getArcY()

function jump(distance, targetBottom, jumpHeight, fail) {
    if (jumpInProgress) return;
    jumpInProgress = true;

    stopCelebrationBounce();

    var animate = document.getElementById("animate");
    var startLeft = parseFloat(animate.style.left) || START_LEFT;
    var startBottom = parseFloat(animate.style.bottom) || START_BOTTOM;

    var JUMP_SPEED = 1.3;
    var totalSteps = Math.round(distance / JUMP_SPEED);
    var stepX = distance / totalSteps;
    var peak = Math.max(startBottom, targetBottom) + jumpHeight;
    var counter = 0;

    document.getElementById('newButton').style.visibility = 'hidden';
    animate.style.zIndex = fail ? 1 : 4;

    jumpID = setInterval(function () {
        counter++;
        var progress = counter / totalSteps;

        animate.style.left = startLeft + stepX * counter + "px";
        animate.style.bottom =
            getArcY(progress, startBottom, targetBottom, peak) + "px";

        if (counter >= totalSteps) {
            clearInterval(jumpID);
            jumpID = null;

            animate.style.left = (startLeft + distance) + "px";
            animate.style.bottom = targetBottom + "px";
            jumpInProgress = false;

            if (result === 'correct' && numCorrect === 3) {
                level++;
                numCorrect = 0;
                reset = true;

                document.getElementById('feedbackDiv').innerHTML =
                    'Correct! You have made it to Level ' + level + '!';

                getStats();
                startCelebrationBounce();

                document.getElementById('newButton').style.visibility = 'visible';
                document.getElementById('newButton').focus();
            } else {
                giveFeedback();
            }
        }
    }, 5);
} // end of jump()

function jumpSafe() {
    jump(150, 30, 40, false);
} // end of jumpSafe()

function jumpFail() {
    jump(110, 5, 30, true);
} // end of jumpFail()

function newProblem() {
    getDisplayForNewProblem();
    firstAttempt = true;
    if (reset) {resetPosition();}
  
    getValues();
    getProblem();
    
    correctAnswer1 = -1*m;
    correctAnswer2 = -1*n;  

    document.getElementById('problemDiv').innerHTML = problem;
    document.getElementById('answerInput1').focus();
} // end of newProblem()

function getValues() {
    a = getRandom(-5, 4); if (a===0) {a=5;}
    m= getRandom(-20, 20);
    n = getRandom(-20, 20);
    b = a*m + a*n;
    c = a*m*n;    
} // end of getValues()

function getProblem() {
    problem = 'Solve for all possible values of the variable.<br /><br />&nbsp&nbsp;&nbsp;';
    
    if (a===1) {}
    else if (a===-1) {problem += '&ndash;';}
    else {problem += a;}
    problem += 'x<sup>2</sup> ';
    
    if (b<0) {
      if (b===-1) {problem += '&ndash; ';} else {problem += '&ndash; ' + Math.abs(b);}
      problem += 'x ';
    } else if (b>0) {
        if (b===1) {}
        else {problem += '+ ' + Math.abs(b);}
        problem += 'x ';
    }
    
    if (c<0) {problem += '&ndash; ' + Math.abs(c);}
    else if (c>0) {problem += ' + ' + Math.abs(c);}
    
    problem += ' = 0';
    problem += '&nbsp;&nbsp;&nbsp&nbsp;&nbsp;(Hint: b<sup>2</sup> &ndash; 4ac = ';
    problem += b*b-4*a*c + ')';
} // end of getProblem()

function getDisplayForNewProblem() {
    document.getElementById('newButton').style.visibility = 'hidden';
    document.getElementById('answerInput1').value = '';
    document.getElementById('answerInput2').value = '';
    document.getElementById('feedbackDiv').innerHTML = '&nbsp;';
    document.getElementById('checkButton').style.display = 'inline';
    document.getElementById('answerInput1').style.display = 'inline';
    document.getElementById('answerInput2').style.display = 'inline';
    document.getElementById('orSpan').style.display = 'inline';
    document.getElementById('errorDiv').style.visibility = 'hidden';
} // end of getDisplayForNewProblem()

function getRandom(min, max) {
    return Math.floor(Math.random()*(max - min + 1)) + min; 
} // end of getRandom(min, max)

function checkAnswer() {
    var input1 = document.getElementById('answerInput1').value;
    var input2 = document.getElementById('answerInput2').value;

    if (input1 !== '' && input2 !== '') {

        document.getElementById('errorDiv').style.visibility = 'hidden';
        document.getElementById('checkButton').style.display = 'none';

        if (firstAttempt) {
            var userAnswer1 = Number(input1);
            var userAnswer2 = Number(input2);

            // Swap if order is reversed
            if (correctAnswer1==userAnswer2 && correctAnswer2==userAnswer1) {
                var temp = userAnswer2;
                userAnswer2 = userAnswer1;
                userAnswer1 = temp;
            }

            if (userAnswer1==correctAnswer1 && userAnswer2==correctAnswer2) {
                result = 'correct';
                numberAttempted++;
                numberCorrect++;
                numCorrect++;
                reset = false;
                getStats();
                jumpSafe();
            } else {
                result = 'incorrect';
                numberAttempted++;
                reset = true;
                numCorrect = 0;
                getStats();
                jumpFail();
            }
        }

        firstAttempt = false;   
        document.getElementById('newButton').style.visibility = 'visible';    
    } else {
        document.getElementById('errorDiv').style.visibility = 'visible';
        document.getElementById('answerInput1').focus();
    }
} // end of checkAnswer()

function giveFeedback() {
    if (result === 'correct') {
        document.getElementById('feedbackDiv').innerHTML = '<br />Correct!';
    } else if (result === 'incorrect') {
        document.getElementById('feedbackDiv').innerHTML = '<br />Correct answer: ';
        document.getElementById('feedbackDiv').innerHTML += correctAnswer1 + ' or ' + correctAnswer2 + '<br />Try again!';
    }
    document.getElementById('newButton').focus();
} // end of giveFeedback()

function getStats() {
    if (numberAttempted === 0) {
        percentCorrect = '';
    } else {
        percentCorrect = (100 * numberCorrect / numberAttempted).toFixed(0);
    }

    var statsText = 'Level: ' + level + '<br />' +
                    'Attempted: ' + numberAttempted + '<br />' +
                    'Correct: ' + numberCorrect;

    if (numberAttempted > 0) {
        statsText += '<br />Percent: ' + percentCorrect + '%';
    }

    document.getElementById('statsDiv').innerHTML = statsText;
} // end of getStats()

function startCelebrationBounce() {
    if (celebrateID) return;

    var animate = document.getElementById("animate");
    var baseBottom = parseFloat(animate.style.bottom) || START_BOTTOM;
    var bounceHeight = 18;
    var frames = 24;
    var frameTime = 18;
    var t = 0;
    var direction = 1;

    celebrateID = setInterval(function () {
        var p = t / frames;
        var eased = 1 - Math.pow(1 - p, 2);

        if (direction === 1) {
            animate.style.bottom =
                (baseBottom + eased * bounceHeight) + "px";
        } else {
            animate.style.bottom =
                (baseBottom + (1 - eased) * bounceHeight) + "px";
        }

        t++;
        if (t > frames) {
            t = 0;
            direction = -direction;
        }
    }, frameTime);
} // end of startCelebrationBounce()

function stopCelebrationBounce() {
    if (celebrateID) {
        clearInterval(celebrateID);
        celebrateID = null;
    }
} // end of stopCelebrationBounce()

</script>

<body onload='loadPage()'>

<h3>Quadratic Formula (Beginner difficulty)</h3>

<div id ="container">
  
<button id='newButton' onclick='newProblem()'>New problem</button>
  
<br /><br />
<span id='problemDiv'>Click the button above to get a new problem</span>
  
<br /><br />
  
<input type='text' id='answerInput1' style='width: 50px;' />
<span id='orSpan'> or </span> 
<input type='text' id='answerInput2' style='width: 50px;' />
<button id='checkButton' onclick='checkAnswer()'>Check answer</button>

<div id='errorDiv' style='color:red; visibility:hidden;'>Type or click an answer in the box</div>

<span id='statsDiv'>Stats</span>
<span id='feedbackDiv'>&nbsp;</span>

<span id='floor1'></span>
<span id='water1'></span>
<span id='floor2'></span>
<span id='water2'></span>
<span id='floor3'></span>
<span id='water3'></span>
<span id='floor4'></span>

<span id ="animate">
    <img src='../images/wolf transparent.png' style='width:150%; height:150%'>
</span>

</div>

</body>
</html>
